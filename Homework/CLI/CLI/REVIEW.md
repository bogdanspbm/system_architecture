# Ревью на архитектуру

## Команда ls

Реализация команды `ls` не составила труда. Публичный интерфейс класса `Command` позволяет легко расширять приложение командами, которые что-то вычисляют, а затем выводят результат на экран. Однако, в общем, наличие у `Command` публичного метода `buildOutput` кажется не очень обоснованным. Например, есть команды, которые ничего не печатают на экран. Текущий интерфейс будет требовать печатать пустую строку для таких команд.

## Команда cd

Нерешаемых проблем при реализации команды `cd` не возникло, а возникшие решаемые проблемы связаны с недостатками архитектуры и реализации (см. ниже).


## Общий обзор

В процессе работы над командами `cd` и `ls` мы обнаружили несколько архитектурных решений и особенностей реализации, обоснованность которых нам показалось сомнительной. Вот некоторые из них:

- непонятно, почему парсингом входа занимается класс `Command`. Куда более естественным кажется отдельный компонент, который преобразует входную строку в некоторую структуру, которая передается команде в момент исполнения;

- достаточно неудачным показалось решение использовать самописную реализацию для парсинга пользовательского ввода. Хотя этого, вероятно, достаточно для того подмножества bash, которое требуется реализовать в рамках курса, расширяемость такого подхода под большим вопросом. Альтернативой могли бы быть, например, стандартные для обработки и преобразования сложных GNU Flex + Bison;

- некорректная реализация некоторых команд. Например, программа некоректно ведет себя на входе `python -c 'print(1)' | python - 'print(input())'`;

- наиболее сложным стало именно написание тестов. Оказалось, что уже написанные тесты могут не проходить в зависимости от порядка их исполнения. Выяснилось, что это связано с тем, что каждая команда берет свои аргументы как из `Stack`, так и из `STDin`, оба из которых реализованы как синглтон. Если предыдущий тест что-то печатает в поток вывода, то команды из следующего теста могут из-за этого получить некорректный набор аргументов.
Подход с двумя объектами синглтонами, хранящими аргументы для команды, показался очень неудобным. Хотелось бы иметь какой-то один объект, который бы хранил аргументы для следующей команды;

- непонятно, почему для хранение текущего пути используется отдельная статическая переменная в классе `SharedVariables`, а не значение по ключу `PWD` внутри `VariableStorage`;

- отсутствие унифицированного формата комментариев. В идеале хотелось бы видеть Javadoc-совместимый формат. Также достаточно нестандартным показалось то, что комментарии были на русском языке;

- отсутствие унифицированного подхода к оформлению кода затрудняет его понимание. Нелишним было бы использование линтера (в том числе в CI).
